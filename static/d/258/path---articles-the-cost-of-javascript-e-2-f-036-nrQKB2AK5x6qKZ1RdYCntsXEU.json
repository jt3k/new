{"data":{"site":{"siteMetadata":{"title":"Веб-стандарты"}},"markdownRemark":{"id":"4fc28d90-0527-56de-95f9-5b6248ab696f","excerpt":"Сколько стоит JavaScript? Перевод « The Cost Of JavaScript » Эдди Османи. По мере того, как мы создаём сайты, всё более и более зависящие от…","html":"<h1>Сколько стоит JavaScript?</h1>\n<p>Перевод «<a href=\"https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e\">The Cost Of JavaScript</a>» Эдди Османи.</p>\n<p>По мере того, как мы создаём сайты, всё более и более зависящие от JavaScript, мы иногда теряем производительность. В этой статье я расскажу про соблюдение некоторых правил, которые могут помочь, если вы хотите, чтобы ваш интерактивный сайт быстро загружался на мобильных устройствах.</p>\n<p><strong>TL;DR</strong> Меньше кода = меньше парсить и компилировать + меньше передавать + меньше распаковывать</p>\n<h3>Сеть</h3>\n<p>Когда большинство разработчиков задумываются о стоимости JavaScript, они думают об этом с точки зрения скорости загрузки и выполнения. Отправка большего количества байт JavaScript обходится дороже при медленном подключении пользователя.</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.625%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACKElEQVQoz32SW28SQRTH+SzG+G588dl+AJ78FMQP4IN9skZNTDDxhQYffKi3piRajZpgkRRLYVkoO529X9jpUlhY9kIR9sLOuAtGkxr9J5Ocyfx/58w5Mxnf9588fKyqKiGEYZjdt69lRYb9YeXbYUvRoDl+8/HT00KhCSEmqRRRAidMjPFyucy4sx+5O7dZQCcHhULh2tUrL1/tcJZbPy4xqiR5s7ubmzdvXC992F+xBIgdvvt1FeKMHwT3HmxJopjsWJYtFrcFUQD9wftKmUFnouO+O6g8KxZpQVjDEkJtyK7jTLJMy5ORqfbQwvfDwA+iJewPym14JGqUqgkjiznro+mMYGLbE4QMRR84jv0LtizLDyPnYi6ohm6YYRSxg2Fd0j+3+b1q4+AE1jlRsVJ3Pp/f2LiVzWZzuVwYhimc5JvPF+Zo4i6wMbTDZcQOzeqptFtt7h1S5a5U42TNcROnhozt5y/ubz1q0gzGcQoPTWvkzt2ZH8WxY0+CtLJ5zIuU1v/S4faboMYrPcfFiQjxY+JFBP/ueTS2fD9Ix4fxZJLCcGA2RYmf2Lxlt1j5O830vGkcx4kHSqjW4lLzGk6ApIHLMCdAWYOAA0cURXU072INI10HDPNn2pfhMGJH40ajBZsd2AZdmml0geZO8QruI/28XCJRSP5VmTXHDbpzCjhWN5J3akhyz/FWLRPPm86QQnBM/nttPvmbcGyB8yGt9jTbJX/pJ3kpeRzt3lSJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\" alt=\"1\" title=\"\" src=\"/static/1-94fe659df354c1c4c7d413472b929d76-ce0d4.png\" srcset=\"/static/1-94fe659df354c1c4c7d413472b929d76-a6060.png 163w,\n/static/1-94fe659df354c1c4c7d413472b929d76-1a895.png 325w,\n/static/1-94fe659df354c1c4c7d413472b929d76-ce0d4.png 650w,\n/static/1-94fe659df354c1c4c7d413472b929d76-63d2a.png 975w,\n/static/1-94fe659df354c1c4c7d413472b929d76-87302.png 1300w,\n/static/1-94fe659df354c1c4c7d413472b929d76-34b20.png 1950w,\n/static/1-94fe659df354c1c4c7d413472b929d76-8b003.png 4000w\" sizes=\"(max-width: 650px) 100vw, 650px\">\n    </span>\n  </span>\n  \n</figure>\n<p>Это может быть проблемой даже в развитых странах, так как <em>фактическая</em> скорость соединения пользователя далеко не всегда соответствует максимально возможной в 3G, 4G или Wi-Fi. Вы можете быть подключены к сети Wi-Fi в кафе, но скорость её передачи может не достигать даже 2G.</p>\n<p>Вы можете снизить затраты на JavaScript следующими способами:</p>\n<ul>\n<li>Отправляйте только тот код, который нужен пользователю. Разделение кода может вам в этом помочь.</li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/optimize-encoding-and-transfer\">Сокращайте код</a> (<a href=\"https://github.com/mishoo/UglifyJS\">uglify</a> для ES5, <a href=\"https://github.com/babel/minify\">babel-minify</a> или <a href=\"https://www.npmjs.com/package/uglify-es\">uglify-es</a> для ES6)</li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/optimize-encoding-and-transfer\">Сжимайте сильнее</a> (используйте <a href=\"https://www.smashingmagazine.com/2016/10/next-generation-server-compression-with-brotli/\">Brotli</a>, <a href=\"https://twitter.com/paulcalvano/status/924660429846208514\">q11</a>, Zopfli или gzip). Brotli превосходит gzip по степени сжатия. Это помогло CertSimple <a href=\"https://speakerdeck.com/addyosmani/the-browser-hackers-guide-to-instant-loading?slide=30\">сэкономить 17%</a> на размере сжатого JS и LinkedIn <a href=\"https://engineering.linkedin.com/blog/2017/05/boosting-site-speed-using-brotli-compression\">сэкономить 4%</a> на времени загрузки.</li>\n<li>Удаляйте неиспользуемый код. Его можно отследить в <a href=\"https://developers.google.com/web/updates/2017/04/devtools-release-notes\">DevTools во вкладке Coverage</a>. Посмотрите в сторону <a href=\"https://webpack.js.org/guides/tree-shaking/\">tree-shaking</a>, <a href=\"https://developers.google.com/closure/compiler/\">Closure Compiler</a> и других библиотек оптимизации библиотек, вроде <a href=\"https://github.com/lodash/babel-plugin-lodash\">lodash-babel-plugin</a> или <a href=\"https://iamakulov.com/notes/webpack-front-end-size-caching/#moment-js\">ContextReplacementPlugin</a> для Webpack — особенно для таких библиотек, как Moment.js. Используйте babel-preset-env и browserlist, чтобы избежать транспиляции новых возможностей, которые уже доступны в современных браузерах. Продвинутые разработчики уже умеют делать подробный <a href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\">анализ бандлов </a><a href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\">Webpack</a> для избавления от ненужных зависимостей.</li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching\">Кэшируйте</a> , чтобы избежать лишней нагрузки на сеть. Определите оптимальное время жизни для скриптов (max-age) и используйте токены ETag, чтобы избежать загрузки неизменённых данных. Сервис-воркеры позволят сделать ваше приложение более независимым от сети и дадут доступ к <a href=\"https://v8project.blogspot.com/2015/07/code-caching.html\">кэшированию кода в V8</a>. Узнайте о долгосрочном кэшировании — <a href=\"https://webpack.js.org/guides/caching/\">хэширование имени файла</a>.</li>\n</ul>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABzElEQVQoz5VS2W7UMBSdP+wf8Dl8BS9IfamKWFTxgCpVbEUIKkrpxMnMJJlO9jhO7MRbFmfCzQxS+8rVjWTZPvcszmIagk+vTwrvJa3V7e87z9si5CwtJFWP/bPrNydN+j5JKbJt1/WDMIqiuKKU1c04jotppOj7c55/bLsxCMM0y6F3uyCK8zL9ih9edOIeF8zzt7gohn7Y7/d93w/DvFhMUAOt5diIQXDecC6E7KDgijaZFaqSN4JjXGQ5LstqelKLPdskl8/im1OCse2sbXtlWTbg4awm9PP5hwZXUZy4ng9iYR8IH8GjFj2+m2SotSJlSUhZVYwyZozptGZkpqrrumn4eCgQBLK01gfP03QV4hWVg9ZhFAfBbLttW2PgdPjx8wsheRDGyHaWyEb2ChosJEkCU2bwq9ub6+2uU2q98RibWcCbUjDbXFy8zbIU1rBDKa0oa9vuUTZ8tBaq7YGtICXIA2/QVUXhqOESkgULEG9/7IPso/MZfPru6tuftZTqfon87cPG9VdrN45iM02XvxwPM5znFghGzsb1QB2ECvgZDJPcICPwVqMBxULAe3H4B6SUMDwrKqHne+aQARAeY/vHDOCn6f9X/QVi42UM5G/9jQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\" alt=\"2\" title=\"\" src=\"/static/2-c572913be3c60f27fff70200935e367d-ce0d4.png\" srcset=\"/static/2-c572913be3c60f27fff70200935e367d-a6060.png 163w,\n/static/2-c572913be3c60f27fff70200935e367d-1a895.png 325w,\n/static/2-c572913be3c60f27fff70200935e367d-ce0d4.png 650w,\n/static/2-c572913be3c60f27fff70200935e367d-63d2a.png 975w,\n/static/2-c572913be3c60f27fff70200935e367d-87302.png 1300w,\n/static/2-c572913be3c60f27fff70200935e367d-9cb13.png 1920w\" sizes=\"(max-width: 650px) 100vw, 650px\">\n    </span>\n  </span>\n  \n</figure>\n<h3>Парсинг и компиляция</h3>\n<p>После загрузки, JS-движок тратит уйму времени на парсинг и компиляцию кода. В Chrome DevTools время парсинга и компиляции показаны желтым в панели Perfomance.</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.603015075376884%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAA3ElEQVQI1x2I2W6CQAAA+f+P4cE0LYS0SY9Eo6YtVFvEjbAsUISVY8U92INW52EyGYsQ2jXDb1Uww3Hb475T2hwbToVho8zrM2FTN8ii6pRQZYvDNDzRGuRRsA+tGswu0Ab7N//nKYnn6PBKoMuzuz6edbFNM7sETgUXPXKO4Bnjr4YVeEBn3WSJax22Lvy+h7tNGm2CbbB6n5PUG5A7IK9NvAo4n+vHj/UL8J1g8QAiH+UYZlV5EnWytNio9XTF3HwRXJtr/k91M6ETHSdpDGdS6ImPmo2KC0m5+gM7otiSVepLGAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\" alt=\"3\" title=\"\" src=\"/static/3-4761c7535672f2bc211d9119c0a3c228-ce0d4.png\" srcset=\"/static/3-4761c7535672f2bc211d9119c0a3c228-a6060.png 163w,\n/static/3-4761c7535672f2bc211d9119c0a3c228-1a895.png 325w,\n/static/3-4761c7535672f2bc211d9119c0a3c228-ce0d4.png 650w,\n/static/3-4761c7535672f2bc211d9119c0a3c228-63d2a.png 975w,\n/static/3-4761c7535672f2bc211d9119c0a3c228-cb059.png 1194w\" sizes=\"(max-width: 650px) 100vw, 650px\">\n    </span>\n  </span>\n  \n</figure>\n<p>Вкладки Bottom-Up и Call Tree позволят оценить время, затраченное на эти задачи:</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.524046434494192%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4ElEQVQY03XP20rEMBAG4Lz/symrLLLY2klzPnbTdJMepTXojVj8Ln6GH4ZhUPONMQYAJa21GOMycM5LQymNMfb/QL7z0zSN41gy52yMscZIKbXWKaUx533f13Xdtu3zBBHG+zjMyzIvq3Vdg9uWsjgMj5RKECruIZTlnwN/oPr2xODq1Uew4DVAdcHVixVV78AooumVtHUDrVJ6PkFKtNbw4PhdvC6j5wwEx3ddBXFJvVyTGswbodJYexxHeeH4BTVAhDR9fHhxW3InlANMnHVe46GjKeogn99rPE/TcfIFVEBOhfl+LuIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\" alt=\"&#x41F;&#x430;&#x43D;&#x435;&#x43B;&#x44C; Performance &#x432; Chrome DevTools: Bottom-Up.\" title=\"\" src=\"/static/4-f8c078d2ee07441ee251353d33d46f6d-ce0d4.png\" srcset=\"/static/4-f8c078d2ee07441ee251353d33d46f6d-a6060.png 163w,\n/static/4-f8c078d2ee07441ee251353d33d46f6d-1a895.png 325w,\n/static/4-f8c078d2ee07441ee251353d33d46f6d-ce0d4.png 650w,\n/static/4-f8c078d2ee07441ee251353d33d46f6d-63d2a.png 975w,\n/static/4-f8c078d2ee07441ee251353d33d46f6d-58c55.png 1206w\" sizes=\"(max-width: 650px) 100vw, 650px\">\n    </span>\n  </span>\n  \n    <figcaption>&#x41F;&#x430;&#x43D;&#x435;&#x43B;&#x44C; Performance &#x432; Chrome DevTools: Bottom-Up.</figcaption>\n</figure>\n<p>Но, почему это имеет значение?</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 27.62951334379906%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABBUlEQVQY02NghAAGEGBjZWVmYQEymJiYubl5mMCAm5sbyGVAAoyMIEGQJiAlJibGw8MNFBUSFOTm4QUyWFhYZWXlmJmZWFlZ5eXlgVxkzRwcnEpKyhwcHGAOj4BP/W6fluMBzTsPzTe6sFjt4gLJrSsr52y+Nm39pd6ZnRcWyp5dqH52oSoQnZqven+9Zoq/MNQkZjZOi/ge+8zZDmn9kyvV51TJLKgW7WtLrO5ZWt65pKA8Z1G9zPx6pfn1igsblGZXyy9rlvOy4kPyBtB+FpjXQXw2JmYOJmAosDCxsbAysvACEQMzNyMLHyMzOwM6gOgDBgUTIzMTAxMjAy4AVAhUAFEOAEQfNK97yBSNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\" alt=\"5\" title=\"\" src=\"/static/5-9a6eb2f78e2a35d3a2a3794218c07540-ce0d4.png\" srcset=\"/static/5-9a6eb2f78e2a35d3a2a3794218c07540-a6060.png 163w,\n/static/5-9a6eb2f78e2a35d3a2a3794218c07540-1a895.png 325w,\n/static/5-9a6eb2f78e2a35d3a2a3794218c07540-ce0d4.png 650w,\n/static/5-9a6eb2f78e2a35d3a2a3794218c07540-63d2a.png 975w,\n/static/5-9a6eb2f78e2a35d3a2a3794218c07540-87302.png 1300w,\n/static/5-9a6eb2f78e2a35d3a2a3794218c07540-34b20.png 1950w,\n/static/5-9a6eb2f78e2a35d3a2a3794218c07540-e42af.png 3822w\" sizes=\"(max-width: 650px) 100vw, 650px\">\n    </span>\n  </span>\n  \n</figure>\n<p>Затраты на парсинг и компиляцию кода могут значительно задержать процесс взаимодействия пользователя с сайтом. Чем больше JavaScript вы отправите, тем больше времени потребуется, чтобы проанализировать и скомпилировать его, а ведь только после этого ваш сайт станет интерактивным.</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB0ElEQVQoz4WSW28SQRiG+y+MiVoXAXd39jS7c1h2l6WoFRYtTShFaqHSAm3Z1CpWiC0BV1Kj3HijP8Go0Tuv/XF+SGNDTWPyTDKZmeebdw4LsskACVPu3xENciMpqyQlm1SQ1KRmYtuD2RjS4wqOI0OQNETsmQIsQEMWj6u4dzIcjU9rO+3wWffVMGqFh/3BaBCNT6Jxcb1aqm6ubdSfHvUOui/nZNhWpU63f7yzFz7Z7aw9rsPSZufgeBTde7C6vReWN7fAX61sNNr7pWpNYw4oZzKgWDxp8Gu3VUgbQ8ZNSYeQCRXfQvqVRYG6aSeTjUloUVQg44XYLKHRXC4VBC4inLm246dUaism4Uu5w8Gk0z9tdl83X0Qq85BJ52TFYjGV1ite2PCftzKTXrb+yCsEzkqBY2+5fRS9effhy+ev377/rNYa10WsEH4uT49tMp0x6vBC3snnnFTaVgnXKJcMclWI+9mlj8PtX5+2fkyqK/dJQp+GPZf/XBsTMUvoFBCNsxGF2MT1k6ZbDOy3Hf4+ZK2KIyhUuSDPgJKzqgA8u+Vm7gbFh6X15WI5XSh7+bJM0zKmc7EvA54ESgASJsgE6N/S/5dnX2jasTj6Z+o3kfuhYH4c+AAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\" alt=\"6\" title=\"\" src=\"/static/6-c1a0a4f520cbf83deeb713314eca8bf4-ce0d4.png\" srcset=\"/static/6-c1a0a4f520cbf83deeb713314eca8bf4-a6060.png 163w,\n/static/6-c1a0a4f520cbf83deeb713314eca8bf4-1a895.png 325w,\n/static/6-c1a0a4f520cbf83deeb713314eca8bf4-ce0d4.png 650w,\n/static/6-c1a0a4f520cbf83deeb713314eca8bf4-63d2a.png 975w,\n/static/6-c1a0a4f520cbf83deeb713314eca8bf4-87302.png 1300w,\n/static/6-c1a0a4f520cbf83deeb713314eca8bf4-9cb13.png 1920w\" sizes=\"(max-width: 650px) 100vw, 650px\">\n    </span>\n  </span>\n  \n</figure>\n<blockquote>\n<p>Байт за байтом, JavaScript является более ресурсозатратным для браузера, чем изображения или шрифты того же размера.\nТом Дэйл</p>\n</blockquote>\n<p>Помимо JavaScript, существует множество затрат, связанных с обработкой изображений эквивалентного размера (они все еще должны быть декодированы!), однако с большей вероятностью именно (загрузка и выполнение) JavaScript негативно скажется на интерактивности страницы.</p>\n<figure>\n    \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.6875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADGklEQVQ4y6WTa0hTYRjHzzlzbmduiuGlCzYpsTKkPkSoQSF2UxJBJcrU8NLHog9WlhZ9MGIYQZ/ChpJiw2I1U7MiKW+bzUszvDR3M9x0Z2c7u7m5Ydve3nfOgj5E0HP4ve9zzvu87/95nnMOhkHjcVmxUSxcCElFsKPwFHQfzSa2YxtGQuIiPsYm2XycwPcTUcQOnIXvIlhEyp5T6TgAYDME40G2QZIhWyEJGzMnGeO2EAIBH63HYr8NCSRC4iFINAFg8EIH6l+f4ADtWT4Al7kAXCEBuA65Cqkjy7OxJN6GiIDL424R5giFaXlp6cdv5yV0Axnnrv0O7xnoJM+DUg6MYYWlDL35Rxe6C5pmpfk39b1nGtyjJQ2ukeIGt7z4lkPb/9LD6F5A5SQUWyEpr7gorayv7a+5Vt1TdaO2r6b+QndZXeNAY9NHtVw5vTJfh/3NkoSFiUdOVu+GbkykPNQKdHh0JARHQ4tMTPopkOmyre3CbIwzjbJYm2krI7La7CIzZRXBe5HLvSpibPR9K009oiiqCm2mJ82xwADiYMYxEE4E2CoQ/SuLZdNSAQABgCwYWIdjKOyHQkGwaT6/rw9OAvWKZnFErbAPzg5bx9RKZtW7yqj0k4xcM0hPfh8LKA3yS5h/zZG7YjJ47ZTWZaMWnZRR7Vy1ad2UacELs3eHhYLBdqhDenyeTtpl7dGYtTKd0SCz0LTMAGejZemVy+d8b/cwp9GrjmFc65lTU1OHlMrxw5+GFFmaufGDAHhT4NpOSCokAfsfq64s5Y0rB0sGZj+Uqubl55YXvmaj56hsi9P8cEo3LvmyONExY1R1fjPNtWspdZdzzVEW3mwymTCtTk/k5h7jFhUVClDzPU7mACwU0Gtm2N11YDUybyMH8vUW7b03E92t76Z7WoY0A08UC8OPP+tG22g3VfJnYsS+jAw2coIhsBdudvt9Xnfghx+EgoHOf6msa7gDx8RiMRcikEgkpFQqjWltbeMpFPJ4s9mczTC2LIax5xhNyxkPmpt5He0d5JxDRUCx8H8bAX8+85RQGSbD3+RPOxzYzeDjSIQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\" alt=\"170 &#x41A;&#x411; &#x441;&#x436;&#x430;&#x442;&#x43E;&#x433;&#x43E; JS &#x43F;&#x440;&#x43E;&#x442;&#x438;&#x432; &#x431;&#x430;&#x439;&#x442;&#x43E;&#x432; JPEG &#x43D;&#x430; Moto G4 &#x432; &#x43C;&#x435;&#x434;&#x43B;&#x435;&#x43D;&#x43D;&#x43E;&#x439; &#x441;&#x435;&#x442;&#x438;.\" title=\"\" src=\"/static/7-41cec0a712803f864152209448afd52e-ce0d4.png\" srcset=\"/static/7-41cec0a712803f864152209448afd52e-a6060.png 163w,\n/static/7-41cec0a712803f864152209448afd52e-1a895.png 325w,\n/static/7-41cec0a712803f864152209448afd52e-ce0d4.png 650w,\n/static/7-41cec0a712803f864152209448afd52e-63d2a.png 975w,\n/static/7-41cec0a712803f864152209448afd52e-87302.png 1300w,\n/static/7-41cec0a712803f864152209448afd52e-34b20.png 1950w,\n/static/7-41cec0a712803f864152209448afd52e-916d8.png 2560w\" sizes=\"(max-width: 650px) 100vw, 650px\">\n    </span>\n  </span>\n  \n    <figcaption>170 &#x41A;&#x411; &#x441;&#x436;&#x430;&#x442;&#x43E;&#x433;&#x43E; JS &#x43F;&#x440;&#x43E;&#x442;&#x438;&#x432; &#x431;&#x430;&#x439;&#x442;&#x43E;&#x432; JPEG &#x43D;&#x430; Moto G4 &#x432; &#x43C;&#x435;&#x434;&#x43B;&#x435;&#x43D;&#x43D;&#x43E;&#x439; &#x441;&#x435;&#x442;&#x438;.</figcaption>\n</figure>\n<p>Байты JavaScript и изображений имеют разную стоимость. Изображения обычно не блокируют основной поток или не препятствуют взаимодействию интерфейсов при декодировании и растеризации. Однако JS может задерживать взаимодействие с сайтом из-за парсинга, компиляции и выполнения.</p>\n<p>Когда мы говорим о медленном выполнении парсинга и компиляции, не стоит забывать, что мы рассматриваем среднестатистическое мобильное устройство. Однако многие пользователи могут иметь телефоны с медленными ЦП и графическими процессорами, без кэша L2 или L3 и могут быть ограничены памятью.</p>\n<blockquote>\n<p>Возможности сети и устройства не всегда совпадают. Пользователь с удивительно быстрым подключением не обязательно имеет лучший процессор для анализа и исполнения JavaScript, отправленного на его устройство. Это также верно и наоборот: ужасное сетевое подключение, но невероятно быстрый процессор.\nКристофер Бакстер, LinkedIn</p>\n</blockquote>\n<p>При проведении тестов скорости JavaScript, я замерял стоимость парсинга ≈1 МБ обычного (несжатого) JavaScript на медленных и высокопроизводительных устройствах. Среднестатистическое устройство тратит на парсинг и компиляцию кода в 2–5 раз больше времени, чем флагманские устройства.</p>\n<figure>\n    <img src=\"images/8.png\" alt=\"Время парсинга для 1Мб JS бандла (≈250KB gzip) на настольных и мобильных устройствах различных классов.\">\n    <figcaption>Время парсинга для 1Мб JS бандла (≈250KB gzip) на настольных и мобильных устройствах различных классов.</figcaption>\n</figure>\n<p>А что если мы проверим реально существующий сайт, например <a href=\"http://cnn.com/\">CNN</a>?</p>\n<p>iPhone 8 потребуется для этого всего 4 секунды, в то время как для среднего по характеристикам смартфона (в нашем случае, Moto G4), необходимо около 14 секунд. Это существенно повлияет на то, как быстро пользователь сможет полностью взаимодействовать с этим сайтом.</p>\n<figure>\n    <img src=\"images/9.png\" alt=\"Сравнение производительности чипа A11 Bionic и Snapdragon 617.\">\n    <figcaption>Сравнение производительности чипа A11 Bionic и Snapdragon 617.</figcaption>\n</figure>\n<p>Это подчеркивает важность проведения тестов на среднестатистических устройствах, а не только на тех, которые могут быть у вас в кармане. Однако контекст очень важен. Оптимизируйте JS для тех типов подключений и устройств, на которых нацелен ваш продукт.</p>\n<figure>\n    <img src=\"images/10.png\" alt=\"\">\n</figure>\n<p>Аналитика поможет вам определить какой тип мобильных устройств используют посетители вашего сайта. Это позволит вам понять реальные ограничения ЦП и ГП, с которыми они работают.</p>\n<p>А мы точно отправляем слишком много JavaScript? Может я ошибся :)</p>\n<p>Используем <a href=\"http://httparchive.org/\">HTTP Archive</a> (топ 500 000 сайтов) для анализа. Прежде чем стать интерактивными, 50% сайтов тратят более 14 секунд, из которых около 4 уходит на парсинг и компиляцию кода.</p>\n<figure>\n    <img src=\"images/11.png\" alt=\"\">\n</figure>\n<p>Много времени требуется для анализа и обработки JS и других ресурсов, и не удивительно, что пользователям приходится ждать, прежде чем начать взаимодействовать со страницей. Мы определённо можем ускорить этот процесс.</p>\n<p>Удаление некритичного JavaScript с ваших страниц может сократить время передачи, анализа, компиляции и потенциальную нагрузку на память. Это также поможет вашим страницам быстрее стать интерактивными.</p>\n<h3>Время исполнения</h3>\n<p>Это не просто парсинг и компиляция. Исполнение JavaScript (выполнение кода после анализа и компиляции) — одна из операций, которая должна выполняться в основном потоке. Этот процесс так же влияет на то, как скоро пользователь сможет взаимодействовать с сайтом.</p>\n<figure>\n    <img src=\"images/12.png\" alt=\"\">\n</figure>\n<blockquote>\n<p>Если скрипт исполняется более 50 мс, то время до интерактивности задерживается на всё время, необходимое для загрузки, компиляции, и исполнения.\nАлекс Рассел</p>\n</blockquote>\n<p>Для решения этой проблемы JavaScript разбивается на небольшие фрагменты, чтобы избежать блокировки основного потока. Посмотрим, можно ли сократить объем выполняемой работы во время выполнения.</p>\n<h3>Паттерны для уменьшения стоимости JS</h3>\n<p>Существуют подходы, которые могут помочь при медленном парсинге, компиляции и невысокой скорости сетевой передачи. Например разбиение фрагментов на основе маршрутов или <a href=\"https://developers.google.com/web/fundamentals/performance/prpl-pattern/\">PRPL</a>.</p>\n<p>PRPL — это паттерн, основанный на агрессивном разделении и кэшировании кода.</p>\n<figure>\n    <img src=\"images/13.png\" alt=\"\">\n</figure>\n<p>Давайте наглядно посмотрим, насколько это улучшит производительность. Проанализируем время загрузки популярных мобильных сайтов и прогрессивных веб-приложений, используя статистику вызовов V8 в рантайме. Как мы видим, на парсинг (показано оранжевым цветом) браузеры тратят значительную часть времени:</p>\n<figure>\n    <img src=\"images/14.png\" alt=\"\">\n</figure>\n<p>Сайту <a href=\"https://wego.com\">Wego</a>, который использует PRPL, удается поддерживать низкое время синтаксического анализа для своих маршрутов, получая интерактивность очень быстро. Многие из вышеперечисленных сайтов сделали акцент на разбиении кода, чтобы попытаться повысить производительность.</p>\n<h3>Другие факторы</h3>\n<p>JavaScript может влиять на производительность страниц другими способами:</p>\n<ul>\n<li>Память. Выполнение страниц может приостанавливаться для очистки памяти. Когда браузер освобождает память, выполнение JS приостанавливается, и это может происходить довольно часто, что нам не очень-то понравится. Избегайте утечек памяти и частых пауз GC, чтобы уменьшить притормаживания страниц.</li>\n<li>Длительное исполнение JavaScript может блокировать основной поток, из-за чего страницы могут не отвечать на запросы. Разбивка выполнения на мелкие части (с помощью <code>requestAnimationFrame()</code> или <code>requestIdleCallback()</code>) позволяет свести к минимуму такие проблемы.</li>\n</ul>\n<h3>Прогрессивная загрузка</h3>\n<p>Многие сайты оптимизируют видимую часть контента. Для быстрой первоначальной отрисовки, при наличии JS большого размера, разработчики разделяют этот процесс на два этапа: выполняют первоначальный рендер на сервере, а затем подгружают JavaScript.</p>\n<p>Будьте осторожны — это тоже требует ресурсов. Как правило, передается более крупный HTML-ответ, который может ограничить вашу интерактивность. Во-вторых, вы частично лишаете пользователя возможности взаимодействия с интерфейсом, пока JavaScript не подгрузится.</p>\n<p>Прогрессивная загрузка может быть лучшим подходом. Отправляется минимально функциональная страница (состоящая только из HTML, JS и CSS, необходимых для текущего состояния). По мере поступления дополнительных ресурсов, приложение выполняет отложенную загрузку и разблокирует дополнительные возможности.</p>\n<figure>\n    <img src=\"images/15.png\" alt=\"Progressive Bootstrapping.\">\n    <figcaption>\n        <a href=\"https://twitter.com/aerotwist/status/729712502943174657\">\n            Progressive Bootstrapping\n        </a>, иллюстрация Пола Льюиса.\n    </figcaption>\n</figure>\n<p>Загрузка кода должны быть оптимальной. PRPL и прогрессивная загрузка — это паттерны, которые могут помочь в достижении этой цели.</p>\n<h3>Подведём итоги</h3>\n<p>Размер передаваемой информации критически важен для сетей с медленной скоростью. Время парсинга важно для устройств, со слабым ГП. Запомните это.</p>\n<p>Команды разработчиков добиваются успеха устанавливая для себя жёсткие ограничения производительности (бюджет быстродействия), соблюдение которых заключается в минимизации затрат на передачу, парсинг и компиляцию JS-кода. Читайте «<a href=\"https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/\">Can You Afford It? Real-world Web Performance Budgets</a>» Алекса Рассела для более подробного изучения темы.</p>\n<figure>\n    <img src=\"images/16.png\" alt=\"Полезно посмотреть, какой объём выделяется для логики приложения.\">\n    <figcaption>Полезно посмотреть, какой объём выделяется для логики приложения.</figcaption>\n</figure>\n<p>Если вы создаете сайт, ориентированный на мобильные устройства, сделайте все возможное для тестирования на нужных типах устройств, держите на низком уровне время парсинга и компиляции JavaScript и утвердите бюджет производительности для того, чтобы команда могла следить за оптимизацией JavaScript.</p>\n<h3>Подробнее</h3>\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/_srJ7eHS3IM\" frameborder=\"0\" allowfullscreen></iframe>\n<ul>\n<li><a href=\"https://medium.com/reloading/javascript-start-up-performance-69200f43b201\">JavaScript Start-up Performance</a></li>\n<li><a href=\"https://nolanlawson.github.io/frontendday-2016/\">Solving the web performance crisis</a> Нолана Лоусон</li>\n<li><a href=\"https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/\">Can you afford it? Real-world performance budgets</a> Алекса Рассела</li>\n<li><a href=\"https://twitter.com/kristoferbaxter/status/908144931125858304\">Evaluating web frameworks and libraries</a> Кристофера Бакстера</li>\n<li><a href=\"https://blog.cloudflare.com/results-experimenting-brotli/\">Results of experimenting with Brotli</a>, опыт Cloudflare</li>\n<li><a href=\"https://medium.com/@samccone/performance-futures-bundling-281543d9a0d5\">Performance Futures</a>, Сэма Сакконе</li>\n</ul>\n<p>Отдельное спасибо Нолану Лоусону, Кристоферу Бакстеру и Джереми Вагнеру.</p>\n<p>Перевод <a href=\"https://medium.com/@nzvtrkk\">Артура Храброва</a>, редактура <a href=\"https://medium.com/@pepelsbey\">Вадима Макеева</a>.</p>","frontmatter":{"title":"Сколько стоит JavaScript?","date":"15 ноября 2017"}}},"pageContext":{"slug":"/articles/the-cost-of-javascript/"}}