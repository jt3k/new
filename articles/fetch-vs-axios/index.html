<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.0.1"/><title data-react-helmet="true"></title><link as="script" rel="preload" href="/component---src-templates-article-jsx-45c82757c31814993ac5.js"/><link as="script" rel="preload" href="/app-d6d0aa46cc7a8319a706.js"/><link as="script" rel="preload" href="/webpack-runtime-49e87d415bc1f49f59fb.js"/><link rel="preload" href="/static/d/814/path---articles-fetch-vs-axios-227-3ee-yStIIo2Cn7wgjswRADWDPNBP9c.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="article"><h1 class="article__title">Генерация HTTP-запросов</h1><div class="article__date">9 февраля 2017</div><div class="article__content"><h1>Генерация HTTP-запросов</h1>
<p>Fetch или Axios.js</p>
<p><em>Перевод «<a href="https://medium.com/p/2b261cdd3af5">Fetch vs. Axios.js for making http requests</a>» Джейсона Арнольда.</em></p>
<p><img src="https://cdn-images-1.medium.com/max/4000/1*zCV86muS6E3yBu52J-Waew.jpeg" alt="Какой хороший пёсик!"><em>Какой хороший пёсик!</em></p>
<p>В одном из заключительных разделов курса <a href="https://www.udemy.com/javascript-es6-tutorial/learn/v4/overview">*ES6 Javascript: The Complete Developer’s Guide</a>* на <em>Udemy</em> Стефан Гридер рассказывает о методе fetch() и о некоторых его недостатках. Он отмечает, что реализация fetch() не идеальна и предлагает другие варианты для выполнения <em>HTTP</em>-запросов. Один из таких вариантов — <a href="https://www.npmjs.com/package/axios">*Axios</a><em>. Раньше я даже не слышал об *Axios</em> и подумал, что подвернулась отличная возможность, чтобы немного покопаться и изучить его. Поскольку это ссылка на материал из курса Стивена, я использую похожие примеры.</p>
<p><em>Axios</em> — это <em>JavaScript</em>-библиотека для выполнения либо <em>HTTP</em>-запросов в <em>Node.js,</em> либо XMLHttpRequests в браузере. Она поддерживает промисы — новинку <em>ES6</em>. Одна из особенностей, которая делает её лучше fetch() — автоматические преобразования <em>JSON</em>-данных.</p>
<p>При использовании fetch() для передачи данных в <em>JSON,</em> необходимо выполнить процесс в два этапа. Сначала сделать фактический запрос, а затем вызвать метод json() для полученных данных с сервера.</p>
<p><strong>*Обновление:</strong> по состоянию на 29 мая, Spotify теперь требует проверки подлинности для всех запросов к их API, поэтому примеры ниже не будут работать корректно.*</p>
<p>Вот простой пример c использованием <em>API Spotify</em>. Установим <em>URL</em> в качестве переменной и передадим её в fetch(). Затем установим колбэк, выводящий в консоль данные в качестве аргумента then().</p>
<pre><code>const url = 'https://api.spotify.com/v1/artists/ID';

fetch(url)
  .then(data => console.log(data));
</code></pre>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*MBFkZoDs-MQb6ztpjmM_ig.png" alt="Ответ метода fetch() по умолчанию."><em>Ответ метода fetch() по умолчанию.</em></p>
<p>Это конечно здорово, но это не те данные, которые мы бы хотели увидеть. Этот ответ сервера сообщил нам, что наш запрос прошел просто отлично. Круто, но мы больше не можем ничего с этим сделать.</p>
<p>Чтобы получить данные, сперва нужно передать их в метод json().</p>
<pre><code>fetch(url)
  .then(response => response.json())
  .then(data => console.log(data));
</code></pre>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*9ubEzV7mNNDPs2ZLh1k3pQ.png" alt="Результат после передачи в json()."><em>Результат после передачи в json().</em></p>
<p>Теперь это те данные, которые мы хотели получить. Попробуем реализовать это через <em>Axios</em>. Первый шаг — установка. Существует несколько вариантов установки:</p>
<p>Либо <em>npm</em>, либо <em>bower</em>:</p>
<pre><code>$ npm install axios
$ bower install axios
</code></pre>
<p>Либо прямо с <em>CDN</em>:</p>
<pre><code>&#x3C;script src="https://unpkg.com/axios/dist/axios.min.js">&#x3C;/script>
</code></pre>
<p>Затем, прямо в консоли, устанавливаем <em>URL</em> в качестве переменной и передаем его в метод axios.get().</p>
<pre><code>const url = 'https://api.spotify.com/v1/artists/ID'

axios.get(url)
  .then(response => console.log(response));
</code></pre>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*r76qb_RUT18pcUmd-SLGBA.png"></p>
<p>Таким образом, с помощью <em>Axios</em> можно обойтись без передачи результатов <em>HTTP</em>-запроса в метод json(). <em>Axios</em> возвращает именно тот объект с данными, который мы ожидаем.</p>
<p>Второй вопрос, который Стивен поднимает: как fetch() обрабатывает ответы на ошибки. Логически можно предположить, что если метод fetch() возвращает сообщение об ошибке, то управление переходит в блок catch() и ошибка обрабатывается там, верно? Не совсем. Вот пример.</p>
<p>Изменим переменную url из предыдущих примеров на некорректную. Ожидается, что ошибка 400 из метода then() перейдёт в блок сatch(), но этого не происходит.</p>
<pre><code>const url = '[https://api.spotify.com/v1/artists/WRONG'](https://api.spotify.com/v1/artists/0OdUWJ0sBjDrqHygGUXeCFcdsds');

fetch(url)
  .catch(error => console.log('BAD', error))
  .then(response => console.log('GOOD', response));
</code></pre>
<p>Для наглядности выведем в консоль BAD в случае, если ошибка обрабатывается в блоке catch(), в противном случае выведем GOOD.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*5ZmMcEBqOE1v_evfWYmc7w.png"></p>
<p>Получаем код ответа 400, но, как вы можете видеть по строке GOOD в консоли, выполнился then(). Как же <em>Axios</em> справляется с этим? Так, как мы и ожидали: выполняется блок сatch() и мы получаем необходимый нам вид ошибки.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*MP3q_dzXbSEsRDri40-UpQ.png"></p>
<p>Строка BAD и ошибка выводятся в консоль.</p>
<p>Метод fetch() — огромный шаг в развитии нативного <em>JS</em> в сторону взаимодействия с сервером. Но он имеет свои недостатки, которых можно избежать, используя сторонние библиотеками, такие как <em>Axios</em>.</p>
<h2><em>Примечания переводчика</em></h2>
<p>Метод fetch() по умолчанию не работает с куками. Для этого необходимо выставить значение credentials</p>
<pre><code>fetch('url', { credentials: 'same-origin' });
</code></pre>
<p><em>Перевод <a href="https://medium.com/@nzvtrkk">Артура Храброва</a>, редактура <a href="https://medium.com/@pepelsbey">Вадима Макеева</a>.</em></p></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-article-jsx","jsonName":"articles-fetch-vs-axios-227","path":"/articles/fetch-vs-axios/"};window.dataPath="814/path---articles-fetch-vs-axios-227-3ee-yStIIo2Cn7wgjswRADWDPNBP9c";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d6d0aa46cc7a8319a706.js"],"component---src-templates-article-list-jsx":["/component---src-templates-article-list-jsx-b2857871934e9a044ec0.js"],"component---src-templates-article-jsx":["/component---src-templates-article-jsx-45c82757c31814993ac5.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx.4282b1e8f5a862472bb9.css","/component---src-pages-404-jsx-51366b521d977380588a.js"],"component---src-pages-articles-jsx":["/component---src-pages-articles-jsx.4282b1e8f5a862472bb9.css","/component---src-pages-articles-jsx-108f450be88982059d31.js"],"component---src-pages-events-jsx":["/component---src-pages-events-jsx.4282b1e8f5a862472bb9.css","/component---src-pages-events-jsx-60d370274f276520b18e.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx.4282b1e8f5a862472bb9.css","/component---src-pages-index-jsx-37c6ff1321838614c8ad.js"]};/*]]>*/</script><script src="/webpack-runtime-49e87d415bc1f49f59fb.js" async=""></script><script src="/app-d6d0aa46cc7a8319a706.js" async=""></script><script src="/component---src-templates-article-jsx-45c82757c31814993ac5.js" async=""></script></body></html>